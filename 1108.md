# Nhật ký công việc - 11/08/2025

## Các tính năng đã triển khai:

*   **Quy trình phê duyệt đặc biệt:**
    *   Đã thêm các trường `is_quy_trinh_dac_biet` và `id_nguoi_duyet_giao_viec` vào model `NhiemVu`.
    *   Đã cập nhật `NhiemVuForm` để tự động thiết lập `is_quy_trinh_dac_biet` dựa trên vai trò của người giao và người nhận việc.
    *   Đã cập nhật `approve_assignment_view` để lưu `id_nguoi_duyet_giao_viec`.
    *   Đã cập nhật `approve_completion_and_rate_nhiemvu_view` để sử dụng thuộc tính `completion_approver` cho việc kiểm tra quyền.
    *   Đã thêm JavaScript vào `nhiemvu_form.html` để cập nhật động checkbox `is_quy_trinh_dac_biet`.

*   **Theo dõi thời gian theo giờ hành chính:**
    *   Đã thêm hàm tiện ích `calculate_business_hours` vào `core/utils.py`.
    *   Đã thêm trường `ngay_hoan_thanh` vào model `NhiemVu`.
    *   Đã cập nhật `approve_completion_and_rate_nhiemvu_view` để tính toán và lưu `thoi_gian_thuc_te` và `ngay_hoan_thanh`.
    *   Đã cập nhật `nhiemvu_detail.html` để hiển thị `thoi_gian_thuc_te`, `ngay_hoan_thanh` và ghi chú nếu hoàn thành vào cuối tuần.

*   **Cải thiện Dashboard:**
    *   Đã thêm chức năng cuộn và giới hạn hiển thị cho các phần "Công việc hết hạn vào ngày mai" và "Công việc sắp đến hạn".
    *   Đã thêm phần "Công việc cần duyệt" với các mục "Duyệt Giao" và "Duyệt Hoàn thành", bao gồm các nút phê duyệt.
    *   Đã hiển thị thêm chi tiết cho "Hồ sơ công việc của Cơ quan", "Kế hoạch của Cơ quan" và "Nhiệm vụ của Cơ quan".

## Các lỗi đã sửa:

*   Đã sửa lỗi `NameError: name 'timezone' is not defined` bằng cách sửa import `timezone` trong `core/views.py`.
*   Đã sửa lỗi `FieldError: Cannot resolve keyword 'completion_approver'` bằng cách sử dụng đối tượng `Q` và lọc trực tiếp trên các trường trong `core/views.py`.
*   Đã sửa lỗi `UnicodeEncodeError` khi liệt kê nhiệm vụ bằng cách loại bỏ tên nhiệm vụ khỏi đầu ra trong lệnh quản lý tạm thời.
